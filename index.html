<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCF Generator | 4-Column Mode</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --success: #059669;
            --success-hover: #047857;
            --bg: #f8fafc;
            --card: #ffffff;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --border: #e2e8f0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg); color: var(--text-main); line-height: 1.5; padding: 1.5rem; }
        .container { max-width: 768px; margin: 0 auto; }
        
        header { text-align: center; margin-bottom: 2rem; }
        .icon-box { display: inline-flex; padding: 0.75rem; background: var(--primary); border-radius: 1rem; color: white; margin-bottom: 1rem; }
        h1 { font-size: 2rem; font-weight: 800; }
        .subtitle { color: var(--text-sub); font-size: 0.9rem; }
        
        .card { background: var(--card); border-radius: 1.5rem; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden; }
        .p-main { padding: 1.5rem; }
        
        .label { font-size: 0.75rem; font-weight: 700; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.05em; display: block; margin-bottom: 0.5rem; }
        textarea { width: 100%; height: 180px; padding: 1rem; border: 2px solid #f1f5f9; border-radius: 1rem; outline: none; font-family: monospace; font-size: 0.85rem; resize: vertical; }
        textarea:focus { border-color: var(--primary); }
        
        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem; }
        @media (max-width: 640px) { .config-grid { grid-template-columns: 1fr; } }

        .input-group { background: var(--bg); padding: 1rem; border-radius: 1rem; border: 1px solid var(--border); }
        input { width: 100%; padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 0.75rem; outline: none; font-size: 0.875rem; }

        .btn { display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.85rem; border-radius: 0.75rem; font-weight: 700; cursor: pointer; border: none; transition: 0.2s; width: 100%; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-clear { background: white; border: 1px solid var(--border); color: var(--text-sub); }
        .btn-download { background: var(--success); color: white; font-size: 1.1rem; padding: 1.25rem; border-radius: 1rem; margin-top: 1rem; }

        #statusBox { padding: 1rem; font-size: 0.85rem; font-weight: 600; border-top: 1px solid var(--border); display: none; text-align: center; }
        .status-amber { background: #fffbeb; color: #92400e; }
        .status-emerald { background: #ecfdf5; color: #065f46; }

        .results { padding: 1.5rem; background: var(--bg); border-top: 1px solid var(--border); display: none; }
        .preview-list { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; max-height: 200px; overflow-y: auto; padding-right: 0.5rem; }
        @media (max-width: 480px) { .preview-list { grid-template-columns: 1fr; } }
        .prev-item { background: white; padding: 0.75rem; border-radius: 0.75rem; border: 1px solid var(--border); }
        .prev-name { font-weight: 700; font-size: 0.85rem; word-break: break-all; }
        .prev-phone { font-family: monospace; font-size: 0.7rem; color: var(--text-sub); margin-top: 0.2rem; }
        
        footer { margin-top: 2rem; text-align: center; font-size: 0.75rem; color: #94a3b8; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="icon-box">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="16" y1="11" x2="22" y2="11"/></svg>
            </div>
            <h1>VCF Generator</h1>
            <p class="subtitle">Student_Class_Parent_Suffix</p>
        </header>

        <div class="card">
            <div class="p-main">
                <label class="label">Paste Data (4 Columns Recommended)</label>
                <textarea id="inputText" placeholder="Example:&#10;John Doe	Class 10	Mr. Smith	9876543210"></textarea>
                
                <div class="config-grid">
                    <div class="input-group">
                        <label class="label" style="font-size: 0.65rem;">Custom Suffix (Optional)</label>
                        <input id="suffix" type="text" oninput="renderPreview()" placeholder="e.g. 2024">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; justify-content: flex-end;">
                        <button onclick="parseContacts()" class="btn btn-primary">Preview Contacts</button>
                        <button onclick="clearAll()" class="btn btn-clear">Clear All</button>
                    </div>
                </div>
            </div>

            <div id="statusBox"></div>

            <div id="resultsArea" class="results">
                <div id="previewList" class="preview-list"></div>
                <button onclick="generateVCF()" class="btn btn-download">Download .VCF File</button>
            </div>
        </div>

        <footer><p>Data is processed 100% locally. Safe for college use.</p></footer>
    </div>

    <script>
        let currentContacts = [];

        function parseContacts() {
            const input = document.getElementById('inputText').value.trim();
            if (!input) { showStatus('Please paste your data first.', 'amber'); return; }

            const lines = input.split('\n');
            currentContacts = lines.map(line => {
                // Split by tabs (Excel default) or commas
                let parts = line.split(/\t|,/).map(p => p.trim()).filter(p => p !== "");
                if (parts.length < 2) return null;

                let phone = '';
                let phoneIndex = -1;
                let maxDigits = 0;

                // Find the phone number column automatically
                parts.forEach((part, index) => {
                    const digits = part.replace(/\D/g, '');
                    if (digits.length > maxDigits) {
                        maxDigits = digits.length;
                        phoneIndex = index;
                        phone = digits;
                    }
                });

                if (phoneIndex !== -1 && maxDigits >= 7) {
                    const nameParts = parts.filter((_, idx) => idx !== phoneIndex);
                    return { joinedName: nameParts.join('_'), phone: phone };
                }
                return null;
            }).filter(c => c && !c.joinedName.toLowerCase().includes('name'));

            if (currentContacts.length === 0) {
                showStatus('No contacts found. Make sure columns are separated by Tabs or Commas.', 'amber');
                document.getElementById('resultsArea').style.display = 'none';
            } else {
                renderPreview();
                showStatus(`Successfully found ${currentContacts.length} contacts!`, 'emerald');
                document.getElementById('resultsArea').style.display = 'block';
            }
        }

        function renderPreview() {
            const list = document.getElementById('previewList');
            const suffix = document.getElementById('suffix').value.trim();
            if (currentContacts.length === 0) return;
            
            list.innerHTML = currentContacts.map(c => `
                <div class="prev-item">
                    <div class="prev-name">${c.joinedName}${suffix ? '_' + suffix : ''}</div>
                    <div class="prev-phone">${c.phone}</div>
                </div>
            `).join('');
        }

        function generateVCF() {
            const suffix = document.getElementById('suffix').value.trim();
            const vcf = currentContacts.map(c => {
                const finalName = suffix ? `${c.joinedName}_${suffix}` : c.joinedName;
                return `BEGIN:VCARD\nVERSION:3.0\nFN:${finalName}\nTEL;TYPE=CELL:${c.phone}\nEND:VCARD`;
            }).join('\n');
            
            const blob = new Blob([vcf], { type: 'text/vcard' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `contacts_${Date.now()}.vcf`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function showStatus(msg, color) {
            const box = document.getElementById('statusBox');
            box.className = `status-${color}`;
            box.style.display = 'block';
            box.innerText = msg;
        }

        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('suffix').value = '';
            document.getElementById('resultsArea').style.display = 'none';
            document.getElementById('statusBox').style.display = 'none';
            currentContacts = [];
        }
    </script>
</body>
</html>
