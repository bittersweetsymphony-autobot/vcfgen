<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCF Contact Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans min-h-screen p-4 md:p-8">
    <div class="max-w-3xl mx-auto">
        <header class="mb-8 text-center">
            <div class="inline-block p-3 bg-blue-600 rounded-2xl mb-4 shadow-lg shadow-blue-200">
                <i data-lucide="user-plus" class="text-white w-8 h-8"></i>
            </div>
            <h1 class="text-4xl font-extrabold tracking-tight">VCF Generator</h1>
            <p class="text-slate-500 mt-2 text-lg">Convert spreadsheet data into mobile-ready contacts.</p>
            <div class="flex justify-center gap-4 mt-4">
                <span class="flex items-center gap-1 text-xs font-medium px-2.5 py-0.5 rounded-full bg-emerald-100 text-emerald-800 border border-emerald-200">
                    <i data-lucide="shield-check" class="w-3 h-3"></i> Privacy Guaranteed: Local Processing Only
                </span>
            </div>
        </header>

        <div class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-center mb-3">
                    <label class="text-sm font-bold uppercase tracking-wider text-slate-500">Paste Sheet Data</label>
                    <div class="text-xs text-slate-400 flex items-center gap-1">
                        <i data-lucide="table" class="w-3.5 h-3.5"></i> Supports Excel & Google Sheets
                    </div>
                </div>
                
                <textarea id="inputText" class="w-full h-44 p-4 border-2 border-slate-100 rounded-2xl focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all text-slate-800 placeholder-slate-400 font-mono text-sm" placeholder="Select 'Name' and 'Phone' columns in your sheet, copy, and paste here..."></textarea>

                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 bg-slate-50 rounded-2xl border border-slate-200">
                        <div class="flex items-center gap-2 mb-2">
                            <i data-lucide="tag" class="text-blue-600 w-4 h-4"></i>
                            <label class="text-sm font-bold text-slate-700">Add Suffix</label>
                        </div>
                        <input id="suffix" type="text" placeholder="e.g. Batch 2024" class="w-full p-3 bg-white border border-slate-300 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                    </div>

                    <div class="flex flex-col gap-3 justify-end">
                        <button onclick="parseContacts()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-100">
                            <i data-lucide="file-text" class="w-5 h-5"></i> Preview Contacts
                        </button>
                        <button onclick="clearAll()" class="w-full bg-white hover:bg-slate-50 text-slate-600 font-semibold py-3 px-6 rounded-xl border border-slate-200 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="trash-2" class="w-4 h-4"></i> Clear All
                        </button>
                    </div>
                </div>
            </div>

            <div id="statusBox" class="hidden px-8 py-3 flex items-center gap-2 text-sm font-medium"></div>

            <div id="resultsArea" class="hidden p-6 md:p-8 bg-slate-50 border-t border-slate-100">
                <div class="flex justify-between items-end mb-4">
                    <h2 class="text-xl font-bold">Ready to Export</h2>
                    <span id="contactCount" class="bg-blue-100 text-blue-700 text-xs font-bold px-2 py-1 rounded-md">0 Contacts</span>
                </div>
                <div id="previewList" class="grid grid-cols-1 sm:grid-cols-2 gap-2 max-h-48 overflow-y-auto mb-6 pr-2 custom-scrollbar"></div>
                <button onclick="generateVCF()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-extrabold py-5 px-6 rounded-2xl transition-all shadow-xl shadow-emerald-200 flex items-center justify-center gap-3 transform active:scale-[0.98] text-lg">
                    <i data-lucide="download" class="w-7 h-7"></i> Download All Contacts (.vcf)
                </button>
            </div>
        </div>

        <footer class="mt-12 mb-8 text-center">
            <p class="text-slate-400 text-xs">Processing happens locally in your browser. No data is stored or sent to servers.</p>
        </footer>
    </div>

    <script>
        let currentContacts = [];

        function parseContacts() {
            const input = document.getElementById('inputText').value.trim();
            const statusBox = document.getElementById('statusBox');
            if (!input) {
                showStatus('Please paste some data first.', 'amber');
                return;
            }

            const lines = input.split('\n');
            currentContacts = lines.map(line => {
                let parts = line.split(/\t|,|;/).map(p => p.trim());
                if (parts.length < 2) return null;
                
                let phone = '', name = '';
                parts.forEach(part => {
                    const cleanVal = part.replace(/[^\d+]/g, '');
                    if (cleanVal.length >= 7 && cleanVal.length <= 15 && !phone) phone = cleanVal;
                    else if (part && !name && !part.includes('@') && !/\d{1,2}\/\d{1,2}\/\d{2,4}/.test(part)) name = part;
                });

                if (!name && parts[0]) name = parts[0];
                if (!phone && parts[1]) phone = parts[1].replace(/[^\d+]/g, '');
                return (name && phone) ? { name, phone } : null;
            }).filter(c => c && !c.name.toLowerCase().includes('name') && !c.name.toLowerCase().includes('timestamp'));

            if (currentContacts.length === 0) {
                showStatus('No contacts found. Check your columns.', 'amber');
                document.getElementById('resultsArea').classList.add('hidden');
            } else {
                renderPreview();
                showStatus(`Successfully parsed ${currentContacts.length} contacts!`, 'emerald');
                document.getElementById('resultsArea').classList.remove('hidden');
            }
            lucide.createIcons();
        }

        function renderPreview() {
            const list = document.getElementById('previewList');
            const suffix = document.getElementById('suffix').value.trim();
            list.innerHTML = currentContacts.map(c => `
                <div class="bg-white p-3 rounded-xl border border-slate-200 flex flex-col shadow-sm">
                    <span class="font-bold text-sm text-slate-800 truncate">${c.name} <span class="text-blue-500 font-normal">${suffix}</span></span>
                    <span class="text-slate-400 font-mono text-[10px] mt-1">${c.phone}</span>
                </div>
            `).join('');
            document.getElementById('contactCount').innerText = `${currentContacts.length} Contacts`;
        }

        function generateVCF() {
            const suffix = document.getElementById('suffix').value.trim();
            const vcf = currentContacts.map(c => 
                `BEGIN:VCARD\nVERSION:3.0\nFN:${c.name}${suffix ? ' ' + suffix : ''}\nTEL;TYPE=CELL:${c.phone}\nEND:VCARD`
            ).join('\n');

            const blob = new Blob([vcf], { type: 'text/vcard' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `contacts_${Date.now()}.vcf`;
            a.click();
            showStatus('Download started!', 'emerald');
        }

        function showStatus(msg, color) {
            const box = document.getElementById('statusBox');
            box.className = `px-8 py-3 flex items-center gap-2 text-sm font-medium bg-${color}-50 text-${color}-700`;
            box.innerHTML = `<i data-lucide="check-circle" class="w-4 h-4"></i> ${msg}`;
            box.classList.remove('hidden');
            lucide.createIcons();
        }

        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('suffix').value = '';
            document.getElementById('statusBox').classList.add('hidden');
            document.getElementById('resultsArea').classList.add('hidden');
            currentContacts = [];
        }

        lucide.createIcons();
    </script>
</body>
</html>